<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
  <head>
    <title>The bracket operator</title>
  </head>

  <body bgcolor="white">
    <h1>Introduction</h1>
The bracket operator is the use of '[' and ']' like accessing
arrays in C.<BR>
<BR>
In YCP, this operator is used to ease handling with (possibly
nested) lists and maps.<BR>
The bracket operator can be applied to any list or map variable
and should be used in favour of (deeply) nested lookup() and select()
cascades.
<BR>
    <h1>Access variant</h1>
<BR>
The access variant of the bracket operator is used for accessing
elements of a list or a map. It effectively replaces <tt>select</tt>
for lists and <tt>lookup</tt> for maps.<BR>
<BR>
    <h2>Accessing lists</h2>
General syntax:<BR>
for simple lists:<BR>
&lt;<i>list-var</i>&gt;<tt>[</tt>&lt;<i>index</i>&gt;<tt>]:</tt>&lt;<i>default-value</i>&gt;<BR>
for nested lists:<BR>
&lt;<i>list-var</i>&gt;<tt>[</tt>&lt;<i>index</i>&gt;<tt>,</tt>&lt;<i>index</i>&gt;<tt>&nbsp;&lt;<i>, ...</i>&gt;]:</tt>&lt;<i>default-value</i>&gt;<BR>
<BR>
<BR><i>index</i> must be an integer and counts from 0 up to the number of elements-1.<BR>
It will return the <i>default-value</i> if you try to access an out-of-bounds element.<BR>
<P>
Note that there must be no space between the closing bracket and the colon.
<P>
Examples:<BR>
<PRE>
{
  list l = [1, 2, 3];

  integer three = l[2]:0;		// == 3

  integer zero = l[42]:0;		// default value

  list ll = [[1,2], [3,4], [5,6]];

  return (ll[1,0]:0 == three);	// returns true
}
</PRE>
    <h2>Accessing maps</h2>
General syntax:<BR>
for simple maps:<BR>
&lt;<i>map-var</i>&gt;<tt>[</tt>&lt;<i>key</i>&gt;<tt>]:</tt>&lt;<i>default-value</i>&gt;<BR>
for nested lists:<BR>
&lt;<i>map-var</i>&gt;<tt>[</tt>&lt;<i>key</i>&gt;<tt>,</tt>&lt;<i>key</i>&gt;<tt>&nbsp;&lt;<i>, ...</i>&gt;]:</tt>&lt;<i>default-value</i>&gt;<BR>
<BR>
<BR><i>key</i> must have an allowed type for maps, integer, string, or symbol.<BR>
It will return <i>default-value</i> if you try to access an non existing key.<BR>
<P>
Note that there must be no space between the closing bracket and the colon.
<P>
Examples:<BR>
<PRE>
{
  map m = $["a":1, "b":2, "c":3];

  integer three = m["c"]:0;		// == 3

  integer zero = m["notthere"]:0;	// default value

  map mm = $["a":$[1:2], "b":$[3:4], "c":$[5:6]];

  return (mm["b",0]:0 == three);	// returns true
}
</PRE>

    <h2>Mixed map/list access</h2>
Since the bracket operator applies to list and maps, you can use it
to access nested lists and maps. But be careful not to mix up the
index/key types.<BR>
<P>
Examples:<BR>
<PRE>
{
  map map_of_lists = $["a":[1, 2, 3], "b":[4,5,6], "c":[7,8,9]];
  integer three = map_of_lists["a",2]:0;		// == 3
  list list_of_maps = [$[1:2], $[3:4], $[5:6]];
  return (list_of_maps[1,0]:0 == three);		// returns true
}
</PRE>
<P>
    <h1>Assign variant</h1>
The bracket operator can also be used on the left side of an assignment (lvalue).<BR>
This changes the list or map element <b>in place (!!)</b> and must be
used with care. See the <A HREF="traps.html#alias">alias trap</A> for details.<BR>
<BR>
If the map or list element does not exist, it will be created. The bracket
operator can therefore replace <tt>add</tt> and <tt>change</tt>.<BR>
Creating a new list element will extend the size of the list. Holes will
be filled with <tt>nil</tt>. See the examples below.<BR>
<BR>
If used as an lvalue, the default value is <b>not</b> allowed.<BR>
<P>
Examples:<BR>
<PRE>
{
  list l = [1,2,3];

  // change the second element
  l[1] = 25;			// l = [1,25,3] now !

  // change the "c" element
  map m = $["a":1, "b":2, "c":3];
  m["c"] = 42;			// m = $["a":1, "b":2, "c":42] now

  // extend the list to 7 elements (0-6)
  l[6] = 6;			// l = [1,25,3,nil,nil,nil,6] now !

  // add a new element to m

  m["zz"] = 13;

  return (mm);			// $["a":1, "b":2, "c":42, "zz":13]
}
</PRE>
<P>
Again: Be careful with the assignment variant of the bracket operator
and don't fall into the <A HREF="traps.html#alias">alias trap</A>.
<p>
<hr>
<address><a href="mailto:kkaempf@suse.de">Klaus K&auml;mpf</a></address>
Last modified: Wed Nov 28 15:21:42 MEST 2001
</body>
</html>
